type: vertical-stack
cards:
  ###########################################################################
  # Top row - Humidity, Condensation, Mould, Drift badges
  ###########################################################################
  - type: horizontal-stack
    cards:
      # --- Humidity badge ---------------------------------------------------
      - type: custom:button-card
        entity: sensor.house_average_humidity
        name: Humidity
        icon: mdi:water-percent
        show_name: true
        show_state: true
        show_label: false
        state_display: |
          [[[
            const h = parseFloat(entity.state);
            if (isNaN(h)) return '-';
            return `${Math.round(h)}%`;
          ]]]
        tap_action:
          action: more-info
        styles:
          card:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - height: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - border-radius: 50%
            - padding: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '10px' : '7px';
                ]]]
            - overflow: hidden
            # Theme-aware background (falls back gracefully)
            - background: var(--ha-card-background, var(--card-background-color))
            - background: >
                color-mix(in srgb,
                  var(--ha-card-background, var(--card-background-color)) 72%,
                  transparent
                )
            - border: |
                [[[
                  const h = parseFloat(entity.state);
                  const danger =
                    states['binary_sensor.humidity_danger']?.state === 'on' ||
                    states['binary_sensor.condensation_danger']?.state === 'on' ||
                    states['binary_sensor.mould_danger']?.state === 'on';

                  if (danger) return '2px solid color-mix(in srgb, var(--error-color) 85%, transparent)';
                  if (isNaN(h)) return '2px solid color-mix(in srgb, var(--divider-color) 55%, transparent)';

                  if (h < 45) return '2px solid color-mix(in srgb, var(--info-color) 80%, transparent)';
                  if (h < 49) return '2px solid color-mix(in srgb, var(--info-color) 65%, transparent)';
                  if (h < 60) return '2px solid color-mix(in srgb, var(--success-color) 70%, transparent)';
                  if (h < 68) return '2px solid color-mix(in srgb, var(--warning-color) 75%, transparent)';
                  return '2px solid color-mix(in srgb, var(--error-color) 85%, transparent)';
                ]]]
            - box-shadow: |
                [[[
                  const h = parseFloat(entity.state);
                  const danger =
                    states['binary_sensor.humidity_danger']?.state === 'on' ||
                    states['binary_sensor.condensation_danger']?.state === 'on' ||
                    states['binary_sensor.mould_danger']?.state === 'on';

                  if (danger) return '0 0 22px color-mix(in srgb, var(--error-color) 45%, transparent)';
                  if (isNaN(h)) return '0 0 16px color-mix(in srgb, var(--divider-color) 35%, transparent)';

                  if (h < 45) return '0 0 20px color-mix(in srgb, var(--info-color) 30%, transparent)';
                  if (h < 49) return '0 0 20px color-mix(in srgb, var(--info-color) 26%, transparent)';
                  if (h < 60) return '0 0 20px color-mix(in srgb, var(--success-color) 26%, transparent)';
                  if (h < 68) return '0 0 20px color-mix(in srgb, var(--warning-color) 28%, transparent)';
                  return '0 0 22px color-mix(in srgb, var(--error-color) 40%, transparent)';
                ]]]
          grid:
            - grid-template-areas: "\"i\" \"n\" \"s\""
            - grid-template-columns: 1fr
            - grid-template-rows: 34px min-content min-content
            - row-gap: 2px
            - justify-items: center
            - align-items: center
          icon:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '32px' : '24px';
                ]]]
            - color: |
                [[[
                  const h = parseFloat(entity.state);
                  const danger =
                    states['binary_sensor.humidity_danger']?.state === 'on' ||
                    states['binary_sensor.condensation_danger']?.state === 'on' ||
                    states['binary_sensor.mould_danger']?.state === 'on';

                  if (danger) return 'var(--error-color)';
                  if (isNaN(h)) return 'var(--secondary-text-color)';
                  if (h < 45) return 'var(--info-color)';
                  if (h < 49) return 'var(--info-color)';
                  if (h < 60) return 'var(--success-color)';
                  if (h < 68) return 'var(--warning-color)';
                  return 'var(--error-color)';
                ]]]
          name:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '12px' : '10px';
                ]]]
            - font-weight: 900
            - opacity: 0.95
            - color: var(--primary-text-color)
          state:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '18px' : '14px';
                ]]]
            - font-weight: 900
            - letter-spacing: 0.2px
            - color: |
                [[[
                  const h = parseFloat(entity.state);
                  const danger =
                    states['binary_sensor.humidity_danger']?.state === 'on' ||
                    states['binary_sensor.condensation_danger']?.state === 'on' ||
                    states['binary_sensor.mould_danger']?.state === 'on';

                  if (danger) return 'var(--error-color)';
                  if (isNaN(h)) return 'var(--secondary-text-color)';
                  if (h < 45) return 'var(--info-color)';
                  if (h < 49) return 'var(--info-color)';
                  if (h < 60) return 'var(--success-color)';
                  if (h < 68) return 'var(--warning-color)';
                  return 'var(--error-color)';
                ]]]
        card_mod:
          style: |
            ha-card {
              position: relative;
              backdrop-filter: blur(10px);
              -webkit-backdrop-filter: blur(10px);
            }
            ha-card::before {
              content: "";
              position: absolute;
              inset: -45%;
              background: linear-gradient(
                120deg,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 40%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent) 48%,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 58%
              );
              transform: translateX(-30%) translateY(-10%) rotate(8deg);
              animation: cvShimmer 8s ease-in-out infinite;
              pointer-events: none;
              opacity: 0.45;
            }
            ha-card::after {
              content: "";
              position: absolute;
              inset: 0;
              border-radius: 50%;
              background: radial-gradient(
                circle at 30% 25%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent),
                transparent 55%
              );
              pointer-events: none;
              opacity: 0.45;
            }
            @keyframes cvShimmer {
              0%   { transform: translateX(-38%) translateY(-12%) rotate(8deg); opacity: 0.25; }
              50%  { transform: translateX(38%)  translateY(10%)  rotate(8deg); opacity: 0.50; }
              100% { transform: translateX(-38%) translateY(-12%) rotate(8deg); opacity: 0.25; }
            }

      # --- Condensation badge ----------------------------------------------
      - type: custom:button-card
        entity: sensor.worst_room_condensation_risk
        name: Condensation
        icon: mdi:water-alert
        show_name: true
        show_state: true
        show_label: false
        state_display: |
          [[[
            const r = entity.state;
            if (!r || r === 'unknown' || r === 'unavailable') return '-';
            return r;
          ]]]
        tap_action:
          action: more-info
        styles:
          card:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - height: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - border-radius: 50%
            - padding: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '10px' : '7px';
                ]]]
            - overflow: hidden
            - background: var(--ha-card-background, var(--card-background-color))
            - background: >
                color-mix(in srgb,
                  var(--ha-card-background, var(--card-background-color)) 72%,
                  transparent
                )
            - border: |
                [[[
                  const r = entity.state;
                  const c =
                    r === 'Danger' ? 'var(--error-color)' :
                    r === 'Risk'   ? 'var(--warning-color)' :
                    r === 'Watch'  ? 'var(--info-color)' :
                    'var(--divider-color)';
                  return `2px solid color-mix(in srgb, ${c} 75%, transparent)`;
                ]]]
            - box-shadow: |
                [[[
                  const r = entity.state;
                  const c =
                    r === 'Danger' ? 'var(--error-color)' :
                    r === 'Risk'   ? 'var(--warning-color)' :
                    r === 'Watch'  ? 'var(--info-color)' :
                    'var(--divider-color)';
                  const amt =
                    r === 'Danger' ? 40 :
                    r === 'Risk'   ? 28 :
                    r === 'Watch'  ? 25 : 18;
                  return `0 0 20px color-mix(in srgb, ${c} ${amt}%, transparent)`;
                ]]]
          grid:
            - grid-template-areas: "\"i\" \"n\" \"s\""
            - grid-template-columns: 1fr
            - grid-template-rows: 34px min-content min-content
            - row-gap: 2px
            - justify-items: center
            - align-items: center
          icon:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '32px' : '24px';
                ]]]
            - color: |
                [[[
                  const r = entity.state;
                  if (r === 'Danger') return 'var(--error-color)';
                  if (r === 'Risk')   return 'var(--warning-color)';
                  if (r === 'Watch')  return 'var(--info-color)';
                  return 'var(--secondary-text-color)';
                ]]]
          name:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '12px' : '10px';
                ]]]
            - font-weight: 900
            - opacity: 0.95
            - color: var(--primary-text-color)
          state:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '18px' : '14px';
                ]]]
            - font-weight: 900
            - color: |
                [[[
                  const r = entity.state;
                  if (r === 'Danger') return 'var(--error-color)';
                  if (r === 'Risk')   return 'var(--warning-color)';
                  if (r === 'Watch')  return 'var(--info-color)';
                  return 'var(--secondary-text-color)';
                ]]]
        card_mod:
          style: |
            ha-card { position: relative; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
            ha-card::before {
              content:""; position:absolute; inset:-45%;
              background: linear-gradient(
                120deg,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 40%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent) 48%,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 58%
              );
              transform: translateX(-30%) translateY(-10%) rotate(8deg);
              animation: cvShimmer 8s ease-in-out infinite;
              pointer-events:none; opacity:0.45;
            }
            ha-card::after {
              content:""; position:absolute; inset:0; border-radius:50%;
              background: radial-gradient(circle at 30% 25%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent),
                transparent 55%
              );
              pointer-events:none; opacity:0.45;
            }
            @keyframes cvShimmer {
              0%{transform:translateX(-38%) translateY(-12%) rotate(8deg);opacity:.25}
              50%{transform:translateX(38%) translateY(10%) rotate(8deg);opacity:.50}
              100%{transform:translateX(-38%) translateY(-12%) rotate(8deg);opacity:.25}
            }

      # --- Mould badge ------------------------------------------------------
      - type: custom:button-card
        entity: sensor.worst_room_mould_risk
        name: Mould
        icon: mdi:mushroom-outline
        show_name: true
        show_state: true
        show_label: false
        state_display: |
          [[[
            const r = entity.state;
            if (!r || r === 'unknown' || r === 'unavailable') return '-';
            return r;
          ]]]
        tap_action:
          action: more-info
        styles:
          card:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - height: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - border-radius: 50%
            - padding: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '10px' : '7px';
                ]]]
            - overflow: hidden
            - background: var(--ha-card-background, var(--card-background-color))
            - background: >
                color-mix(in srgb,
                  var(--ha-card-background, var(--card-background-color)) 72%,
                  transparent
                )
            - border: |
                [[[
                  const r = entity.state;
                  const c =
                    r === 'Danger' ? 'var(--error-color)' :
                    r === 'Risk'   ? 'var(--warning-color)' :
                    r === 'Watch'  ? 'var(--info-color)' :
                    'var(--divider-color)';
                  return `2px solid color-mix(in srgb, ${c} 75%, transparent)`;
                ]]]
            - box-shadow: |
                [[[
                  const r = entity.state;
                  const c =
                    r === 'Danger' ? 'var(--error-color)' :
                    r === 'Risk'   ? 'var(--warning-color)' :
                    r === 'Watch'  ? 'var(--info-color)' :
                    'var(--divider-color)';
                  const amt =
                    r === 'Danger' ? 40 :
                    r === 'Risk'   ? 28 :
                    r === 'Watch'  ? 25 : 18;
                  return `0 0 20px color-mix(in srgb, ${c} ${amt}%, transparent)`;
                ]]]
          grid:
            - grid-template-areas: "\"i\" \"n\" \"s\""
            - grid-template-columns: 1fr
            - grid-template-rows: 34px min-content min-content
            - row-gap: 2px
            - justify-items: center
            - align-items: center
          icon:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '32px' : '24px';
                ]]]
            - color: |
                [[[
                  const r = entity.state;
                  if (r === 'Danger') return 'var(--error-color)';
                  if (r === 'Risk')   return 'var(--warning-color)';
                  if (r === 'Watch')  return 'var(--info-color)';
                  return 'var(--secondary-text-color)';
                ]]]
          name:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '12px' : '10px';
                ]]]
            - font-weight: 900
            - opacity: 0.95
            - color: var(--primary-text-color)
          state:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '18px' : '14px';
                ]]]
            - font-weight: 900
            - color: |
                [[[
                  const r = entity.state;
                  if (r === 'Danger') return 'var(--error-color)';
                  if (r === 'Risk')   return 'var(--warning-color)';
                  if (r === 'Watch')  return 'var(--info-color)';
                  return 'var(--secondary-text-color)';
                ]]]
        card_mod:
          style: |
            ha-card { position: relative; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
            ha-card::before {
              content:""; position:absolute; inset:-45%;
              background: linear-gradient(
                120deg,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 40%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent) 48%,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 58%
              );
              transform: translateX(-30%) translateY(-10%) rotate(8deg);
              animation: cvShimmer 8s ease-in-out infinite;
              pointer-events:none; opacity:0.45;
            }
            ha-card::after {
              content:""; position:absolute; inset:0; border-radius:50%;
              background: radial-gradient(circle at 30% 25%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent),
                transparent 55%
              );
              pointer-events:none; opacity:0.45;
            }
            @keyframes cvShimmer {
              0%{transform:translateX(-38%) translateY(-12%) rotate(8deg);opacity:.25}
              50%{transform:translateX(38%) translateY(10%) rotate(8deg);opacity:.50}
              100%{transform:translateX(-38%) translateY(-12%) rotate(8deg);opacity:.25}
            }

      # --- Drift badge ------------------------------------------------------
      - type: custom:button-card
        entity: sensor.house_humidity_drift_7d
        name: Drift
        icon: mdi:chart-line-variant
        show_name: true
        show_state: true
        show_label: false
        state_display: |
          [[[
            const d = parseFloat(entity.state);
            if (isNaN(d)) return '-';
            return `${d > 0 ? '+' : ''}${d.toFixed(1)}%`;
          ]]]
        tap_action:
          action: more-info
        styles:
          card:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - height: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '122px' : '88px';
                ]]]
            - border-radius: 50%
            - padding: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '10px' : '7px';
                ]]]
            - overflow: hidden
            - background: var(--ha-card-background, var(--card-background-color))
            - background: >
                color-mix(in srgb,
                  var(--ha-card-background, var(--card-background-color)) 72%,
                  transparent
                )
            - border: |
                [[[
                  const d = parseFloat(entity.state);
                  if (isNaN(d)) return '2px solid color-mix(in srgb, var(--divider-color) 55%, transparent)';
                  if (Math.abs(d) >= 5.0) return '2px solid color-mix(in srgb, var(--error-color) 85%, transparent)';
                  if (Math.abs(d) < 0.6) return '2px solid color-mix(in srgb, var(--divider-color) 75%, transparent)';
                  if (d > 0) return '2px solid color-mix(in srgb, var(--warning-color) 75%, transparent)';
                  return '2px solid color-mix(in srgb, var(--info-color) 75%, transparent)';
                ]]]
            - box-shadow: |
                [[[
                  const d = parseFloat(entity.state);
                  if (isNaN(d)) return '0 0 16px color-mix(in srgb, var(--divider-color) 35%, transparent)';
                  if (Math.abs(d) >= 5.0) return '0 0 22px color-mix(in srgb, var(--error-color) 40%, transparent)';
                  if (Math.abs(d) < 0.6) return '0 0 18px color-mix(in srgb, var(--divider-color) 35%, transparent)';
                  if (d > 0) return '0 0 20px color-mix(in srgb, var(--warning-color) 28%, transparent)';
                  return '0 0 20px color-mix(in srgb, var(--info-color) 25%, transparent)';
                ]]]
          grid:
            - grid-template-areas: "\"i\" \"n\" \"s\""
            - grid-template-columns: 1fr
            - grid-template-rows: 34px min-content min-content
            - row-gap: 2px
            - justify-items: center
            - align-items: center
          icon:
            - width: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '32px' : '24px';
                ]]]
            - color: |
                [[[
                  const d = parseFloat(entity.state);
                  if (isNaN(d)) return 'var(--secondary-text-color)';
                  if (Math.abs(d) >= 5.0) return 'var(--error-color)';
                  if (Math.abs(d) < 0.6) return 'var(--secondary-text-color)';
                  if (d > 0) return 'var(--warning-color)';
                  return 'var(--info-color)';
                ]]]
          name:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '12px' : '10px';
                ]]]
            - font-weight: 900
            - opacity: 0.95
            - color: var(--primary-text-color)
          state:
            - font-size: |
                [[[
                  const w = window.innerWidth || 390;
                  return (w >= 760) ? '18px' : '14px';
                ]]]
            - font-weight: 900
            - color: |
                [[[
                  const d = parseFloat(entity.state);
                  if (isNaN(d)) return 'var(--secondary-text-color)';
                  if (Math.abs(d) >= 5.0) return 'var(--error-color)';
                  if (Math.abs(d) < 0.6) return 'var(--secondary-text-color)';
                  if (d > 0) return 'var(--warning-color)';
                  return 'var(--info-color)';
                ]]]
        card_mod:
          style: |
            ha-card { position: relative; backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); }
            ha-card::before {
              content:""; position:absolute; inset:-45%;
              background: linear-gradient(
                120deg,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 45%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent) 49%,
                color-mix(in srgb, var(--primary-text-color) 0%, transparent) 58%
              );
              transform: translateX(-30%) translateY(-10%) rotate(8deg);
              animation: cvShimmer 8s ease-in-out infinite;
              pointer-events:none; opacity:0.45;
            }
            ha-card::after {
              content:""; position:absolute; inset:0; border-radius:50%;
              background: radial-gradient(circle at 30% 25%,
                color-mix(in srgb, var(--primary-text-color) 12%, transparent),
                transparent 55%
              );
              pointer-events:none; opacity:0.45;
            }
            @keyframes cvShimmer {
              0%{transform:translateX(-38%) translateY(-12%) rotate(8deg);opacity:.25}
              50%{transform:translateX(38%) translateY(10%) rotate(8deg);opacity:.50}
              100%{transform:translateX(-38%) translateY(-12%) rotate(8deg);opacity:.25}
            }

  ###########################################################################
  # Comfort Band - with floating chevron controlling humidity_constellation
  ###########################################################################
  - type: custom:button-card
    entity: input_boolean.humidity_constellation_expanded
    name: Comfort Band
    icon: mdi:shield-check-outline
    show_icon: true
    show_state: false
    show_label: true
    tap_action:
      action: toggle
    hold_action:
      action: more-info

    custom_fields:
      chevron: |
        [[[
          const expanded =
            states['input_boolean.humidity_constellation_expanded']?.state === 'on';
          const icon = expanded ? 'mdi:chevron-up' : 'mdi:chevron-down';
          return `<ha-icon icon="${icon}"></ha-icon>`;
        ]]]

    label: |
      [[[
        const lowEnt    = states['sensor.house_humidity_target_low'];
        const highEnt   = states['sensor.house_humidity_target_high'];
        const hEnt      = states['sensor.house_average_humidity'];

        const low  = lowEnt  ? parseFloat(lowEnt.state)  : NaN;
        const high = highEnt ? parseFloat(highEnt.state) : NaN;
        const h    = hEnt    ? parseFloat(hEnt.state)    : NaN;

        const bandTxt = (isNaN(low) || isNaN(high))
          ? 'Target humidity: -'
          : `Target humidity: ${low.toFixed(0)}-${high.toFixed(0)}%`;

        let comfort = 'Comfort: -';
        if (!isNaN(h) && !isNaN(low) && !isNaN(high)) {
          if (h < low) {
            comfort = 'Comfort: A bit dry - humidify / reduce extraction.';
          } else if (h <= high) {
            comfort = 'Comfort: In the sweet spot - keep steady.';
          } else {
            comfort = 'Comfort: High - ventilate / extract for 10-20 min.';
          }
        }

        const condEnt    = states['sensor.worst_room_condensation'];
        const mouldEnt   = states['sensor.worst_room_mould'];

        const condRoom   = condEnt  ? condEnt.state  : null;
        const condRisk   = states['sensor.worst_room_condensation']?.attributes?.risk;
        const mouldRoom  = mouldEnt ? mouldEnt.state : null;
        const mouldRisk  = states['sensor.worst_room_mould']?.attributes?.risk;

        let condLine = 'Condensation: -';
        if (condRisk && condRisk !== 'Unknown' && condRoom && condRoom !== 'Unknown') {
          condLine = `Condensation: ${condRisk} in ${condRoom}`;
        }

        let mouldLine = 'Mould: -';
        if (mouldRisk && mouldRisk !== 'Unknown' && mouldRoom && mouldRoom !== 'Unknown') {
          mouldLine = `Mould: ${mouldRisk} in ${mouldRoom}`;
        }

        return `${bandTxt}\n${comfort}\n${condLine}\n${mouldLine}`;
      ]]]

    styles:
      card:
        - position: relative
        - border-radius: 22px
        - padding: 12px 14px
        - overflow: hidden
        - background: var(--ha-card-background, var(--card-background-color))
        - background: >
            color-mix(in srgb,
              var(--ha-card-background, var(--card-background-color)) 75%,
              transparent
            )
        - border: 2px solid color-mix(in srgb, var(--divider-color) 60%, transparent)
        - box-shadow: 0 0 18px color-mix(in srgb, var(--divider-color) 35%, transparent)
      grid:
        - grid-template-areas: "\"i n\" \"l l\""
        - grid-template-columns: 22px 1fr
        - column-gap: 10px
        - row-gap: 6px
        - align-items: center
      icon:
        - width: 18px
        - color: var(--secondary-text-color)
      name:
        - font-size: 15px
        - font-weight: 900
        - letter-spacing: 0.2px
        - color: var(--primary-text-color)
      label:
        - white-space: pre-line
        - font-size: 13px
        - line-height: 1.35
        - opacity: 0.95
        - text-align: left
        - color: var(--primary-text-color)
      custom_fields:
        chevron:
          - position: absolute
          - left: 10px
          - bottom: 8px
          - width: 24px
          - height: 24px
          - display: flex
          - align-items: center
          - justify-content: center
          - border-radius: 999px
          - background: >
              color-mix(in srgb,
                var(--ha-card-background, var(--card-background-color)) 85%,
                transparent
              )
          - border: 1px solid color-mix(in srgb, var(--divider-color) 70%, transparent)
          - box-shadow: 0 0 12px color-mix(in srgb, var(--divider-color) 55%, transparent)
          - color: |
              [[[
                const expanded =
                  states['input_boolean.humidity_constellation_expanded']?.state === 'on';
                return expanded ? 'var(--success-color)' : 'var(--secondary-text-color)';
              ]]]
          - opacity: 0.95
          - pointer-events: none

  ###########################################################################
  # Humidity Constellation - dropdown panel (24h chart)
  ###########################################################################
  - type: conditional
    conditions:
      - entity: input_boolean.humidity_constellation_expanded
        state: "on"
    card:
      type: custom:config-template-card
      entities:
        - sensor.humidity_constellation_series
      card:
        type: custom:apexcharts-card
        header:
          show: true
          title: Humidity Constellation (24h)
          show_states: false
        graph_span: 24h
        span:
          start: day
        apex_config:
          chart:
            height: 260px
            toolbar:
              show: false
            foreColor: var(--primary-text-color)
          grid:
            borderColor: color-mix(in srgb, var(--divider-color) 60%, transparent)
            strokeDashArray: 3
          stroke:
            curve: smooth
            width: 2.5
          legend:
            show: true
            position: bottom
            fontSize: 12px
            labels:
              colors: var(--primary-text-color)
          xaxis:
            labels:
              style:
                colors: var(--secondary-text-color)
          yaxis:
            labels:
              style:
                colors: var(--secondary-text-color)
        yaxis:
          - min: 30
            max: 90
            decimals: 0
        series: ${states['sensor.humidity_constellation_series'].attributes.series}
